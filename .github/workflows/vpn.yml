name: Tailscale-VPN
on:
  workflow_dispatch:

jobs:
  tailscale:
    runs-on: ubuntu-latest
    timeout-minutes: 3600

    steps:
      - name: Install Tailscale (fast)
        run: curl -fsSL https://tailscale.com/install.sh | sh

      - name: Connect as exit node
        run: |
          sudo tailscale up \
            --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} \
            --hostname="vpn-${{ github.run_id }}" \
            --advertise-exit-node
          echo "TAILSCALE_IP=$(tailscale ip -4)" >> $GITHUB_ENV

      - name: Keep alive (light)
        run: |
          echo "Exit node ready: $TAILSCALE_IP"
          while true; do sleep 600; done
